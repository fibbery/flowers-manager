# ğŸš€ æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æœåŠ¡å™¨è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šLinux (Ubuntu/CentOS/Debian) æˆ– macOS
- **Node.js**ï¼šv14.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**ï¼šæœ€å°‘ 512MB
- **ç£ç›˜ç©ºé—´**ï¼šæœ€å°‘ 500MB
- **ç«¯å£**ï¼š3000ï¼ˆå¯ä¿®æ”¹ï¼‰

### 2. å®‰è£… Node.js

#### Ubuntu/Debian
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

#### CentOS/RHEL
```bash
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs
```

#### éªŒè¯å®‰è£…
```bash
node --version
npm --version
```

## ğŸ“¦ éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ä¸€ï¼šä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

1. **ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨**

```bash
# ä½¿ç”¨ scp
scp -r flowers-manager user@your-server:/path/to/

# æˆ–ä½¿ç”¨ git
ssh user@your-server
cd /path/to/
git clone your-repo-url flowers-manager
```

2. **æ·»åŠ æ‰§è¡Œæƒé™**

```bash
cd flowers-manager
chmod +x deploy.sh
chmod +x stop.sh
```

3. **è¿è¡Œéƒ¨ç½²è„šæœ¬**

```bash
./deploy.sh
```

4. **é€‰æ‹©å¯åŠ¨æ–¹å¼**

è„šæœ¬ä¼šæç¤ºé€‰æ‹©ï¼š
- `1` - ä½¿ç”¨ PM2 å¯åŠ¨ï¼ˆæ¨èï¼‰
- `2` - ä½¿ç”¨ nohup åå°è¿è¡Œ
- `3` - ç›´æ¥è¿è¡Œï¼ˆå‰å°ï¼‰

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

1. **å®‰è£…åç«¯ä¾èµ–**

```bash
cd backend
npm install --production
```

2. **æ„å»ºå‰ç«¯**

```bash
cd ../frontend
npm install
npm run build
```

3. **éƒ¨ç½²å‰ç«¯åˆ°åç«¯**

```bash
rm -rf ../backend/public
mv dist ../backend/public
```

4. **å¯åŠ¨æœåŠ¡**

```bash
cd ../backend
node server-prod.js
```

## ğŸ”§ PM2 è¿›ç¨‹ç®¡ç†ï¼ˆæ¨èï¼‰

### å®‰è£… PM2

```bash
npm install -g pm2
```

### ä½¿ç”¨ PM2 å¯åŠ¨

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶
cd flowers-manager
pm2 start ecosystem.config.js

# æ–¹å¼äºŒï¼šç›´æ¥å¯åŠ¨
cd backend
pm2 start server-prod.js --name flowers-manager
```

### PM2 å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs flowers-manager

# å®æ—¶æ—¥å¿—
pm2 logs flowers-manager --lines 100

# é‡å¯æœåŠ¡
pm2 restart flowers-manager

# åœæ­¢æœåŠ¡
pm2 stop flowers-manager

# åˆ é™¤æœåŠ¡
pm2 delete flowers-manager

# ä¿å­˜é…ç½®ï¼ˆå¼€æœºè‡ªå¯ï¼‰
pm2 save
pm2 startup
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æ—¥å¿—ä½ç½®
pm2 logs flowers-manager --format

# æ¸…ç©ºæ—¥å¿—
pm2 flush

# æ—¥å¿—è½®è½¬
pm2 install pm2-logrotate
```

## ğŸŒ é…ç½®åŸŸåå’Œ Nginxï¼ˆå¯é€‰ï¼‰

### å®‰è£… Nginx

```bash
# Ubuntu/Debian
sudo apt-get install nginx

# CentOS/RHEL
sudo yum install nginx
```

### é…ç½® Nginx åå‘ä»£ç†

åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/flowers-manager`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # æ—¥å¿—
    access_log /var/log/nginx/flowers-manager-access.log;
    error_log /var/log/nginx/flowers-manager-error.log;

    # åå‘ä»£ç†åˆ° Node.js åº”ç”¨
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        proxy_pass http://localhost:3000;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/flowers-manager /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### é…ç½® HTTPSï¼ˆä½¿ç”¨ Let's Encryptï¼‰

```bash
# å®‰è£… certbot
sudo apt-get install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu (UFW)
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable

# CentOS (firewalld)
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 2. é™åˆ¶æ–‡ä»¶æƒé™

```bash
cd flowers-manager
chmod 600 backend/.env
chmod 644 backend/flowers.db
```

### 3. å®šæœŸå¤‡ä»½æ•°æ®åº“

åˆ›å»ºå¤‡ä»½è„šæœ¬ `backup.sh`ï¼š

```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/path/to/backups"
mkdir -p $BACKUP_DIR
cp backend/flowers.db $BACKUP_DIR/flowers_$DATE.db
# ä¿ç•™æœ€è¿‘ 7 å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "flowers_*.db" -mtime +7 -delete
```

æ·»åŠ åˆ° crontabï¼š

```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½
0 2 * * * /path/to/flowers-manager/backup.sh
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# PM2 çŠ¶æ€
pm2 status

# ç³»ç»Ÿèµ„æº
pm2 monit

# è¿›ç¨‹è¯¦æƒ…
pm2 show flowers-manager
```

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æ—¥å¿—
tail -f logs/combined.log

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/flowers-manager-access.log
```

### 3. æ€§èƒ½ç›‘æ§

```bash
# å®‰è£… PM2 ç›‘æ§æ’ä»¶
pm2 install pm2-server-monit

# æŸ¥çœ‹ç›‘æ§é¢æ¿
pm2 web
```

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### ä½¿ç”¨ Git

```bash
cd flowers-manager
git pull origin main
./deploy.sh
pm2 restart flowers-manager
```

### æ‰‹åŠ¨æ›´æ–°

```bash
cd flowers-manager

# 1. åœæ­¢æœåŠ¡
./stop.sh

# 2. æ›´æ–°ä»£ç 
# ä¸Šä¼ æ–°çš„ä»£ç æ–‡ä»¶

# 3. é‡æ–°éƒ¨ç½²
./deploy.sh
```

## ğŸ›  æ•…éšœæ’æŸ¥

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs flowers-manager --err

# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :3000

# æ£€æŸ¥ Node ç‰ˆæœ¬
node --version
```

### 2. æ•°æ®åº“é”™è¯¯

```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -lh backend/flowers.db

# æµ‹è¯•æ•°æ®åº“è¿æ¥
sqlite3 backend/flowers.db "SELECT * FROM persons;"
```

### 3. å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# PM2 è®¾ç½®å†…å­˜é™åˆ¶
pm2 start ecosystem.config.js --max-memory-restart 500M
```

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

ç¼–è¾‘ `backend/.env`ï¼š

```bash
NODE_ENV=production
PORT=3000
HOST=0.0.0.0
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### 1. å¯ç”¨ Gzip å‹ç¼©ï¼ˆNginxï¼‰

åœ¨ Nginx é…ç½®ä¸­æ·»åŠ ï¼š

```nginx
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/json application/javascript;
```

### 2. è°ƒæ•´ PM2 é›†ç¾¤æ¨¡å¼

```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'flowers-manager',
    script: './backend/server-prod.js',
    instances: 2,  // æˆ– 'max' ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒ
    exec_mode: 'cluster'
  }]
};
```

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] Node.js å·²å®‰è£…ï¼ˆv14+ï¼‰
- [ ] é¡¹ç›®ä»£ç å·²ä¸Šä¼ 
- [ ] ä¾èµ–å·²å®‰è£…
- [ ] å‰ç«¯å·²æ„å»º
- [ ] æœåŠ¡å·²å¯åŠ¨
- [ ] ç«¯å£å·²å¼€æ”¾ï¼ˆ3000ï¼‰
- [ ] é˜²ç«å¢™å·²é…ç½®
- [ ] Nginx å·²é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] HTTPS å·²é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] PM2 å¼€æœºè‡ªå¯å·²è®¾ç½®
- [ ] æ•°æ®åº“å¤‡ä»½å·²é…ç½®
- [ ] æ—¥å¿—è½®è½¬å·²è®¾ç½®
- [ ] ç›‘æ§å·²å¯ç”¨

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¿®æ”¹ç«¯å£ï¼Ÿ

A: ç¼–è¾‘ `backend/.env` æ–‡ä»¶ï¼Œä¿®æ”¹ `PORT=3000` ä¸ºå…¶ä»–ç«¯å£

### Q: å¦‚ä½•å…è®¸å¤–ç½‘è®¿é—®ï¼Ÿ

A: 
1. ç¡®ä¿ `HOST=0.0.0.0` (ä¸æ˜¯ localhost)
2. å¼€æ”¾é˜²ç«å¢™ç«¯å£
3. é…ç½®äº‘æœåŠ¡å•†çš„å®‰å…¨ç»„è§„åˆ™

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

A: æ•°æ®åº“æ–‡ä»¶ä½äº `backend/flowers.db`ï¼Œå®šæœŸå¤åˆ¶è¯¥æ–‡ä»¶å³å¯

### Q: å¦‚ä½•æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼Ÿ

A: 
- PM2: `pm2 logs flowers-manager`
- Nginx: `/var/log/nginx/flowers-manager-access.log`

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²æˆåŠŸåï¼Œè®¿é—®ï¼š

- **ç›´æ¥è®¿é—®**ï¼šhttp://your-server-ip:3000
- **åŸŸåè®¿é—®**ï¼šhttp://your-domain.comï¼ˆé…ç½® Nginx åï¼‰
- **HTTPS è®¿é—®**ï¼šhttps://your-domain.comï¼ˆé…ç½®è¯ä¹¦åï¼‰

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸŒ¸

